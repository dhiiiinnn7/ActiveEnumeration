# ActiveEnumeration

## Overview
ActiveEnumeration is a comprehensive tool for active network enumeration and reconnaissance. The script can perform ICMP and ARP scans, port scanning, DNS reconnaissance, and analyze traffic generated during these operations. It ensures low bandwidth usage, making it ideal for environments where network load needs to be minimized.

# Table of Contents

1. [Features](#features)
2. [Usage](#usage)
    - [Prerequisites](#prerequisites)
    - [Running the Script](#running-the-script)
    - [Script Options](#script-options)
    - [Example Commands](#example-commands)
3. [Functions Breakdown](#functions-breakdown)
    - [IP Address Conversion](#ip-address-conversion)
        - [`ipaddr_to_int()`](#ipaddr_to_int)
        - [`int_to_ipaddr()`](#int_to_ipaddr)
    - [Bandwidth Throttling](#bandwidth-throttling)
        - [`calculate_sleep()`](#calculate_sleep)
    - [ICMP Enumeration](#icmp-enumeration)
        - [`enumerate_icmp_ping()`](#enumerate_icmp_ping)
    - [ARP Enumeration](#arp-enumeration)
        - [`enumerate_arp()`](#enumerate_arp)
    - [Port Scanning](#port-scanning)
        - [`enumerate_ports()`](#enumerate_ports)
    - [DNS Reconnaissance](#dns-reconnaissance)
        - [`perform_dns_reconnaissance()`](#perform_dns_reconnaissance)
    - [Traffic Analysis](#traffic-analysis)
        - [`tcpdump_capture_remove()`](#tcpdump_capture_remove)
        - [`tcpdump_capture()`](#tcpdump_capture)
4. [Output](#output)
    - [Human-readable Results](#human-readable-results)
    - [Example of Enumeration Results](#example-of-enumeration-results)
5. [License](#license)
6. [Acknowledgements](#acknowledgements)
7. [Contact](#contact)


## Features
- **ICMP Protocol Enumeration**: Scan and detect the operational state of hosts using ICMP pings.
- **ARP Protocol Enumeration**: Use ARP requests to identify active devices and retrieve their MAC addresses.
- **Combined ICMP and ARP Enumeration**: Perform both ICMP and ARP scans to comprehensively map the network.
- **Port Scanning**: Scan for well-known ports (FTP, SSH, Telnet, SMTP, HTTP) on each device.
- **DNS Reconnaissance**: Identify domain names associated with IP addresses and perform DNS enumeration.
- **Traffic Analysis**: Measure the traffic generated by the script and ensure it stays within specified bandwidth limits.
- **Human-readable Output**: Generate grep-friendly output for easy analysis and documentation.

## Usage
### Prerequisites
- Bash shell (typically available on Unix-based systems)
- Utilities: `ping`, `arping`, `nmap`, `tcpdump`, `dnsrecon`

## Running the Script

### Clone the Repository
```sh
git clone https://github.com/dhiiiinnn7/ActiveEnumeration.git
cd ActiveEnumeration.sh
```

### Make the Script Executable
```sh
chmod +x ActiveEnumeration.sh
```

### Run the Script
```sh
./ActiveEnumeration.sh
```

## Script Options
The script presents a menu with the following options:

- ICMP Protocol Enumeration
- ARP Protocol Enumeration
- Combined ICMP and ARP Enumeration
- DNS Reconnaissance
- Traffic Analysis
- Exit

## Example Commands
- ICMP Protocol Enumeration: Scan a range of IP addresses and log active hosts.
- ARP Protocol Enumeration: Identify devices and log their MAC addresses.
- Combined ICMP and ARP Enumeration: Perform both ICMP and ARP scans sequentially.
- DNS Reconnaissance: Retrieve and enumerate domain names for IP addresses.
- Traffic Analysis: Measure the amount of traffic generated by the script.

## Functions Breakdown

### IP Address Conversion

`ipaddr_to_int()` - Converts a dotted-quad IP address to its integer equivalent for efficient processing.

```sh
local ip="$1"
local a b c d
IFS=. read -r a b c d <<< "$ip"
echo "$((a * 256 ** 3 + b * 256 ** 2 + c * 256 + d))"
```

`int_to_ipaddr()` - Converts an integer representation of an IP address back to the dotted-quad format.

```sh
local num=$1
echo "$((num >> 24 & 255)).$((num >> 16 & 255)).$((num >> 8 & 255)).$((num & 255))"
```

### Bandwidth Throttling

`calculate_sleep()` - Ensures that the script's data transmission rate does not exceed 300 bytes per second.
```sh
local current_time=$(date +%s)
local elapsed_time=$(awk "BEGIN {print $current_time - $start_time}")
local expected_time=$(awk "BEGIN {print $bytes_sent / $BANDWIDTH_LIMIT}")

if ((elapsed_time < expected_time)); then
    local sleep_time=$(awk "BEGIN {print $expected_time - $elapsed_time}")
    sleep $sleep_time
    echo "Sleeping for $sleep_time seconds"
else
    echo "Not sleeping"
fi
```

### ICMP Enumeration

`enumerate_icmp_ping()` - Scans a range of IP addresses using ICMP pings and logs the results.

```sh
local start_int end_int ip_int current_ip
start_int=$(ipaddr_to_int "$start_ip")
end_int=$(ipaddr_to_int "$end_ip")

for ((ip_int=start_int; ip_int<=end_int; ip_int++)); do
    current_ip=$(int_to_ipaddr "$ip_int")
    ping_result=$(ping -c 2 -t 10 -s 1000 "$current_ip")
    bytes_sent=$((bytes_sent + (PACKET_SIZE * 2)))
    calculate_sleep

    if echo "$ping_result" | grep -q "bytes from"; then
        echo "[ICMP - ACTIVE HOST] HOST $current_ip STATUS: UP AND DETECTED BY ICMP USING PING" | tee -a enumeration_results.txt
        icmp_detected=$((icmp_detected + 1))
    else
        echo "[ICMP - INACTIVE HOST] HOST $current_ip STATUS: DOWN OR NOT RESPONDING TO ICMP" | tee -a enumeration_results.txt
        not_responding_icmp=$((not_responding_icmp + 1))
    fi
done
```

### ARP Enumeration
`enumerate_arp()` - Uses ARP requests to identify active devices within a range of IP addresses.

```sh
local start_int end_int ip_int current_ip arping_result mac_address
start_int=$(ipaddr_to_int "$start_ip")
end_int=$(ipaddr_to_int "$end_ip")

for ((ip_int=start_int; ip_int<=end_int; ip_int++)); do
    current_ip=$(int_to_ipaddr "$ip_int")
    arping_result=$(sudo arping -c 1 "$current_ip" 2>&1)

    if [ $? -eq 0 ]; then
        mac_address=$(echo "$arping_result" | grep "bytes from" | awk '{print $4}')
        echo "[ARP - ACTIVE HOST] HOST $current_ip STATUS: UP AND DETECTED BY ARP WITH MAC: $mac_address" | tee -a enumeration_results.txt
        arp_detected=$((arp_detected + 1))
    else
        echo "[ARP - INACTIVE HOST] HOST $current_ip DID NOT RESPOND TO ARP" | tee -a enumeration_results.txt
        not_responding_arp=$((not_responding_arp + 1))
    fi
done
```

### Port Scanning
`enumerate_ports()` - Scans for well-known ports on each device in the specified range.

```sh
local start_int end_int ip_int current_ip open_ports
start_int=$(ipaddr_to_int "$start_ip")
end_int=$(ipaddr_to_int "$end_ip")

for ((ip_int=start_int; ip_int<=end_int; ip_int++)); do
    current_ip=$(int_to_ipaddr "$ip_int")
    echo "SCANNING $current_ip FOR OPEN PORTS: FTP, SSH, Telnet, SMTP and HTTP..."

    open_ports=$(nmap -p 21,22,23,25,80 "$current_ip" | grep open)

    if [[ -z "$open_ports" ]]; then
        echo "[NO OPEN PORT] NO OPEN PORTS (FTP, SSH, Telnet, SMTP and HTTP) DETECTED FOR $current_ip" | tee -a enumeration_results.txt
    else
        while IFS= read -r line; do
            echo "[OPEN PORT] OPEN PORTS DETECTED FOR $current_ip: $line" | tee -a enumeration_results.txt
        done <<< "$open_ports"
    fi
done
```

### DNS Reconnaissance

`perform_dns_reconnaissance()` - Performs DNS reconnaissance on a range of IP addresses.

```sh
local start_int end_int ip_int current_ip domain_name
start_int=$(ipaddr_to_int "$start_ip")
end_int=$(ipaddr_to_int "$end_ip")

for ((ip_int=start_int; ip_int<=end_int; ip_int++)); do
    current_ip=$(int_to_ipaddr "$ip_int")
    domain_name=$(nslookup "$current_ip" | grep "name" | awk '{print $4}' | sed 's/\.$//')

    if [ ! -z "$domain_name" ]; then
        echo "[DNS - DOMAIN FOUND] Found domain $domain_name for IP $current_ip" | tee -a enumeration_results.txt
        dnsrecon -d "$domain_name" -t std,a,axfr
    else
        echo "[DNS - DOMAIN NOT FOUND] No domain found for IP $current_ip" | tee -a enumeration_results.txt
    fi
done
```

### Traffic Analysis

Measures and analyzes the traffic generated by the script.

`tcpdump_capture_remove()`

```sh
if [ -f "$CAPTURE_FILE" ]; then
    sudo rm -f "$CAPTURE_FILE"
fi
```
`tcpdump_capture()`
```sh
local action=$1

case $action in
    start)
        sudo tcpdump -i $NETWORK_INTERFACE -w $CAPTURE_FILE &
        TCPDUMP_PID=$!
        echo "Started tcpdump with PID $TCPDUMP_PID"
        ;;
    stop)
        sudo kill -SIGTERM $TCPDUMP_PID
        wait $TCPDUMP_PID

        sudo tcpdump -r "$CAPTURE_FILE" -nn -q | awk '
            BEGIN {
                FS="\t"
                total_packets = 0
                total_bytes = 0
                first_packet = 1
            }
            {
                total_packets++
                match($0, /length ([0-9]+)/, arr)
                total_bytes += arr[1]
                if(first_packet == 1) {
                    first_packet = 0
                } else {
                    current_time = $1
                    delay = current_time - previous_time
                    print
                     previous_time = current_time
                }
                previous_time = current_time
            }
            END {
                print "Total packets captured:", total_packets
                print "Total bytes captured:", total_bytes
                if (total_packets > 0) {
                    print "Average packet size (bytes):", (total_bytes / total_packets)
                }
            }
        '
        ;;
    *)
        echo "Invalid action for tcpdump_capture: $action"
        ;;
esac
```

## Example Usage

### ICMP Protocol Enumeration

```sh

./ActiveEnumeration.sh
# Select option 1 for ICMP Protocol Enumeration
```

### ARP Protocol Enumeration

```sh
./ActiveEnumeration.sh
# Select option 2 for ARP Protocol Enumeration
```

### Combined ICMP and ARP Enumeration

```sh
./ActiveEnumeration.sh
# Select option 3 for Combined ICMP and ARP Enumeration
```

### Port Scanning

```sh
./ActiveEnumeration.sh
# Select option 4 for Port Scanning
```

### DNS Reconnaissance

```sh
./ActiveEnumeration.sh
# Select option 5 for DNS Reconnaissance
```

### Traffic Analysis

```sh

./ActiveEnumeration.sh
# Select option 6 for Traffic Analysis
```

## Output

### Human-readable Results

- ICMP Enumeration: Lists active and inactive hosts.
- ARP Enumeration: Lists active hosts with their MAC addresses.
- Port Scanning: Shows open ports for services like FTP, SSH, Telnet, SMTP, and HTTP.
- DNS Reconnaissance: Provides domain names associated with IP addresses.
-Traffic Analysis: Displays total packets and bytes captured, average packet size, and delay between packets.

### Example of Enumeration Results
```yaml
[ICMP - ACTIVE HOST] HOST 192.168.69.101 STATUS: UP AND DETECTED BY ICMP USING PING
[ICMP - INACTIVE HOST] HOST 192.168.69.102 STATUS: DOWN OR NOT RESPONDING TO ICMP
[ARP - ACTIVE HOST] HOST 192.168.69.103 STATUS: UP AND DETECTED BY ARP WITH MAC: 00:1A:2B:3C:4D:5E
[ARP - INACTIVE HOST] HOST 192.168.69.104 DID NOT RESPOND TO ARP
[OPEN PORT] OPEN PORTS DETECTED FOR 192.168.69.105: 21/tcp open  ftp
[DNS - DOMAIN FOUND] Found domain example.com for IP 192.168.69.106
[DNS - DOMAIN NOT FOUND] No domain found for IP 192.168.69.107
Total packets captured: 1257
Total bytes captured: 139686
Average packet size (bytes): 111.126
```

## License
This project is licensed under the Apache License 2.0. See the LICENSE file for details.

## Acknowledgements
- Tools and utilities like ping, arping, nmap, tcpdump, dnsrecon

## Contact
For any queries, please reach out to dhinislammd@gmail.com.
